{"config":{"lang":["pt"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Padr\u00e3o das API's LeadTax","text":"<p>O intuito desta documentac\u0327a\u0303o e\u0301 explicar o padra\u0303o das APIs da LeadTax.</p> <p>Temos inumeras API's e sem uma documenta\u00e7\u00e3o comum e padra\u0303o, criamos essa documentac\u0327a\u0303o para facilitar o trabalho de quem trabalha com APIs da LeadTax.</p>"},{"location":"#introducao","title":"Introduc\u0327a\u0303o","text":"<p>API's Disponi\u0301veis:</p> <ul> <li>API Municipal Essas API's s\u00e3o as que precisam da rota de <code>consultar</code>, <code>escriturar</code>, <code>guia</code>e em alguns casos <code>excluir</code>.</li> </ul>"},{"location":"consultar/","title":"Consultar","text":""},{"location":"consultar/#consultar","title":"\ud83d\udd0d Consultar","text":"<p>A opera\u00e7\u00e3o de consulta permite recuperar informa\u00e7\u00f5es sobre notas fiscais previamente escrituradas em determinado per\u00edodo, bem como verificar a integridade e o status das notas processadas via integra\u00e7\u00e3o.</p>"},{"location":"consultar/#requisicao","title":"\ud83d\udd3c Requisi\u00e7\u00e3o","text":"<p>Requisi\u00e7\u00e3o para a rota <code>/consultar</code></p> <p>Metodo: <code>POST</code></p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo dados_acesso.</p>"},{"location":"consultar/#dados_acesso-objeto","title":"\ud83d\udd10 <code>dados_acesso</code> (objeto)","text":"<p>Objeto que cont\u00e9m as credenciais de autentica\u00e7\u00e3o e os par\u00e2metros de filtragem por compet\u00eancia, utilizados para estabelecer a sess\u00e3o de comunica\u00e7\u00e3o com o sistema municipal e delimitar o escopo da consulta.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>municipio</code> string Sim Nome do municipio. <code>inscricao</code> string Sim CNPJ/CPF/Inscricao estadual/inscricao municipal da empresa (somente n\u00fameros). <code>extra</code> string N\u00e3o Informa\u00e7\u00f5es extras. Para caso a prefeitura precise de mais informa\u00e7\u00f5es. <code>login_password</code> string Sim Senha de login. <code>mes</code> integer Sim M\u00eas de compet\u00eancia (1 a 12). <code>ano</code> integer Sim Ano de compet\u00eancia (ex: <code>2025</code>). <code>identificador</code> string N\u00e3o Identificador da prefeitura. Algumas prefeituras precisam do numero identificador para fazer login. <code>nome_filial</code> string N\u00e3o Nome da filial. Algumas prefeituras precisam para identificar a filial. <code>certificado_b64</code> string N\u00e3o Certificado digital em base64 no formato <code>.pfx</code>. <code>certificado_password</code> string N\u00e3o Senha do certificado digital."},{"location":"consultar/#exemplo-de-payload","title":"\ud83d\udcd1 Exemplo de Payload","text":"<pre><code>{\n  \"dados_acesso\": {\n    \"municipio\": \"prata\",\n    \"inscricao\": \"27473570\",\n    \"extra\": \"extra\",\n    \"login_password\": \"123456\",\n    \"mes\": 5,\n    \"ano\": 2025,\n    \"identificador\": \"123456\",\n    \"nome_filial\": \"Filial 1\",\n    \"certificado_b64\": \"-----BEGIN CERTIFICATE-----\\n-----END CERTIFICATE-----\",\n    \"certificado_password\": \"123456\"\n\n  }\n}\n</code></pre> <p>Obs: N\u00e3o precisamos enviar na consulta as <code>notas</code> pois ser\u00e3o descartadas. Assim conseguimos montar payloads mas f\u00e1cil de ler. </p>"},{"location":"consultar/#resposta","title":"\ud83d\udd3d  Resposta","text":"<p>Formato: <code>json</code></p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>cnpj_filial</code> string Sim CNPJ do emitente da nota (somente n\u00fameros). <code>nome_municipio</code> string N\u00e3o Nome do municipio. <code>cnpj_prestador</code> string Sim CNPJ do prestador. Alguns municipios n\u00e3o tem o CNPJ do prestador, para esses casos precisa ver com o cliente <code>numero_nota</code> integer Sim N\u00famero da nota fiscal. Sempre que possivel envie como inteiro. Se tiver 0 \u00e0 esquerda ou for muito longo envie como string. <code>data_emissao</code> string Sim Data de emiss\u00e3o no formato <code>DD/MM/AAAA</code>. <code>situacao</code> boolean Sim Indica se houve reten\u00e7\u00e3o de ISS (<code>true</code> ou <code>false</code>). <code>total</code> float Sim Valor total da nota incluidos os ISS. <code>valor_principal</code> float Sim Valor somente do ISS. <code>chave</code> string Sim Chave montada juntando <code>cnpj_filial</code> + <code>cnpj_prestador</code> + <code>numero_nota</code> + <code>data_emissao</code> Pode manter o \"/\" da data de emiss\u00e3o."},{"location":"escriturar/","title":"Escriturar","text":""},{"location":"escriturar/#escriturar","title":"\ud83d\udcdd Escriturar","text":"<p>A opera\u00e7\u00e3o de escritura\u00e7\u00e3o permite a inclus\u00e3o de notas fiscais no sistema municipal.</p>"},{"location":"escriturar/#requisicao","title":"\ud83d\udd3c Requisi\u00e7\u00e3o","text":"<p>Requisi\u00e7\u00e3o para a rota <code>/escriturar</code></p> <p>Metodo: <code>POST</code></p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo dados_acesso e notas.</p>"},{"location":"escriturar/#dados_acesso-objeto","title":"\ud83d\udd10 <code>dados_acesso</code> (objeto)","text":"<p>Objeto que cont\u00e9m as credenciais de autentica\u00e7\u00e3o e os par\u00e2metros de filtragem por compet\u00eancia, utilizados para estabelecer a sess\u00e3o de comunica\u00e7\u00e3o com o sistema municipal e delimitar o escopo da consulta.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>municipio</code> string Sim Nome do municipio. <code>inscricao</code> string Sim CNPJ/CPF/Inscricao estadual/inscricao municipal da empresa (somente n\u00fameros). <code>extra</code> string N\u00e3o Informa\u00e7\u00f5es extras. Para caso a prefeitura precise de mais informa\u00e7\u00f5es. <code>login_password</code> string Sim Senha de login. <code>mes</code> integer Sim M\u00eas de compet\u00eancia (1 a 12). <code>ano</code> integer Sim Ano de compet\u00eancia (ex: <code>2025</code>). <code>identificador</code> string N\u00e3o Identificador da prefeitura. Algumas prefeituras precisam do numero identificador para fazer login. <code>nome_filial</code> string N\u00e3o Nome da filial. Algumas prefeituras precisam para identificar a filial. <code>certificado_b64</code> string N\u00e3o Certificado digital em base64 no formato <code>.pfx</code>. <code>certificado_password</code> string N\u00e3o Senha do certificado digital."},{"location":"escriturar/#notas-array-de-objetos","title":"\ud83d\udcc4 <code>notas</code> (array de objetos)","text":"<p>Lista de notas fiscais a serem escrituradas.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o Exemplo <code>id</code> integer Sim Identificador interno da nota. ID da nota no DB 1 <code>cnpj_prestador</code> string Sim CNPJ do prestador da nota (somente n\u00fameros). \"12345678901234\" <code>nome_municipio</code> string Sim Nome do municipio. \"prata\" <code>numero_nota</code> string Sim N\u00famero da nota fiscal. \"123456789\" <code>serie</code> string N\u00e3o S\u00e9rie da nota fiscal. \"A\" <code>data_emissao</code> string Sim Data de emiss\u00e3o no formato <code>DD/MM/AAAA</code>. \"01/01/2025\" <code>retido</code> boolean Sim Indica se houve reten\u00e7\u00e3o de ISS (<code>true</code> ou <code>false</code>). false <code>valor_nota</code> string Sim Valor da nota fiscal. Separado por \".\" (ponto) \"100.00\" <code>aliquota</code> string Sim Valor da al\u00edquota da nota fiscal. Separado por \".\" (ponto) \"2.00\" <code>cod_servico</code> string Sim C\u00f3digo do servi\u00e7o. \"07.01\" <code>valor_iss</code> string Sim Valor do ISS. Separado por \".\" (ponto) \"10.00\" <code>simples</code> boolean Sim Indica se o prestador possui simples nacional (<code>true</code> ou <code>false</code>). true <code>cod_ibge</code> string Sim C\u00f3digo do IBGE do municipio do prestador. \"123456\""},{"location":"escriturar/#exemplo-de-payload","title":"\ud83d\udcd1 Exemplo de Payload","text":"<pre><code>{\n  \"dados_acesso\": {\n    \"municipio\": \"prata\",\n    \"inscricao\": \"27473570\",\n    \"extra\": \"extra\",\n    \"login_password\": \"123456\",\n    \"mes\": 5,\n    \"ano\": 2025,\n    \"identificador\": \"123456\",\n    \"nome_filial\": \"Filial 1\",\n    \"certificado_b64\": \"-----BEGIN CERTIFICATE-----\\n-----END CERTIFICATE-----\",\n    \"certificado_password\": \"123456\"\n\n  },\n  \"notas\": [\n    {\n      \"id\": 1,\n      \"cnpj_prestador\": \"27473570\",\n      \"nome_municipio\": \"S\u00e3o Paulo\",\n      \"numero_nota\": \"123456789\",\n      \"serie\": \"A\",\n      \"data_emissao\": \"01/01/2025\",\n      \"retido\": false,\n      \"valor_nota\": \"100.00\",\n      \"aliquota\": \"2.00\",\n      \"cod_servico\": \"1234\",\n      \"valor_iss\": \"10.00\",\n      \"simples\": false\n    }\n  ]\n}\n</code></pre>"},{"location":"escriturar/#resposta","title":"\ud83d\udd3d Resposta","text":"<p>A maioria das API's rodam dentro de workers(processos ass\u00edncronos) utilizando rq, portanto, a resposta n\u00e3o \u00e9 retornada diretamente ao cliente.</p> <p>Como \u00e9 um processo ass\u00edncrono, precisamos retornar um <code>id</code> que representa o status da escritura\u00e7\u00e3o.</p> <p>Algumas notas ser\u00e3o escrituradas em batchs, por isso, o <code>id</code> retornado n\u00e3o representa uma unica nota, mas sim um batch de notas.</p> <p>Exemplo: S\u00e3o Enviados 50 notas, mas s\u00e3o criados batches de 10 notas, por isso, o <code>id</code> retornado representa o status de 5 batches.</p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo <code>id</code> gerada automaticamente pelo worker.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o <code>id</code> integer Sim ID do status da escritura\u00e7\u00e3o. <code>status</code> string Sim Status da escritura\u00e7\u00e3o."},{"location":"escriturar/#resposta-de-escriturar-no-worker","title":"\ud83d\udd28 Resposta de escriturar no worker","text":"<p>Mesmo as notas escrituradas dentro do worker precisam retornar algo para a gente saber se foram escrituradas ou n\u00e3o.</p> <p>Atualmente salvamos o status da escritura\u00e7\u00e3o no DB, mas isso pode mudar.</p> <p>Retorne <code>true</code> no <code>sucesso</code> se foi escriturada, <code>false</code> se n\u00e3o foi escriturada.</p> <p>Formato: <code>json</code> | <code>dict</code></p> <p>Body: Array de Objeto JSON.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o <code>id</code> integer Sim ID do status da escritura\u00e7\u00e3o. <code>sucesso</code> boolean Sim Status da escritura\u00e7\u00e3o <code>true</code> ou <code>false</code>. <code>numero_nota</code> string Sim N\u00famero da nota escriturada. <code>cnpj_prestador</code> string Sim CNPJ do prestador. <code>mensagem</code> string Sim Mensagem com o motivo do erro. <p>Obs: Deve retornar isso para cada nota escriturada. Independente se voc\u00ea j\u00e1 salvou no DB ou n\u00e3o, pois precisamos dessa informa\u00e7\u00e3o para criar o log.</p>"},{"location":"gerar/","title":"Gerar","text":""},{"location":"gerar/#gerar","title":"\ud83d\udcdd Gerar","text":"<p>A Opera\u00e7\u00e3o para gera\u00e7\u00e3o de guias de recolhimento para pagamento de ISS.</p>"},{"location":"gerar/#requisicao","title":"\ud83d\udd3c Requisi\u00e7\u00e3o","text":"<p>Requisi\u00e7\u00e3o para a rota <code>/gerar</code></p> <p>Metodo: <code>POST</code></p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo dados_acesso e notas.</p>"},{"location":"gerar/#dados_acesso-objeto","title":"\ud83d\udd10 <code>dados_acesso</code> (objeto)","text":"<p>Objeto que cont\u00e9m as credenciais de autentica\u00e7\u00e3o e os par\u00e2metros de filtragem por compet\u00eancia, utilizados para estabelecer a sess\u00e3o de comunica\u00e7\u00e3o com o sistema municipal e delimitar o escopo da consulta.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>municipio</code> string Sim Nome do municipio. <code>inscricao</code> string Sim CNPJ/CPF/Inscricao estadual/inscricao municipal da empresa (somente n\u00fameros). <code>extra</code> string N\u00e3o Informa\u00e7\u00f5es extras. Para caso a prefeitura precise de mais informa\u00e7\u00f5es. <code>login_password</code> string Sim Senha de login. <code>mes</code> integer Sim M\u00eas de compet\u00eancia (1 a 12). <code>ano</code> integer Sim Ano de compet\u00eancia (ex: <code>2025</code>). <code>identificador</code> string N\u00e3o Identificador da prefeitura. Algumas prefeituras precisam do numero identificador para fazer login. <code>nome_filial</code> string N\u00e3o Nome da filial. Algumas prefeituras precisam para identificar a filial. <code>certificado_b64</code> string N\u00e3o Certificado digital em base64 no formato <code>.pfx</code>. <code>certificado_password</code> string N\u00e3o Senha do certificado digital. <p>Deixar isso para conversar depois com o pessoal por causa dos municipios que n\u00e3o precisam escriturar, s\u00f3 escolhem a nota para gerar a guia</p>"},{"location":"gerar/#resposta","title":"\ud83d\udd3d Resposta","text":"<p>Resposta da rota <code>/gerar</code></p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo guias.</p>"},{"location":"gerar/#guia-objeto","title":"\ud83d\udcc4 guia (Objeto)","text":"<p>Objeto contendo as informa\u00e7\u00f5es da guia de recolhimento. O PDF precisa ser convertido para base64.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>pdf</code> string Sim PDF da guia de recolhimento. O PDF precisa ser convertido para base64. <code>vencimento</code> string Sim Data de vencimento da guia de recolhimento(DD/MM/AAAA). Caso n\u00e3o tenha vencimento, busque dentro do PDF. <code>valor_principal</code> float Sim Valor somente do ISS. Caso n\u00e3o tenha vencimento, busque dentro do PDF. <code>valor_base</code> float Sim Valor total da nota incluidos os ISS. Caso n\u00e3o tenha vencimento, busque dentro do PDF. <code>codigo_barra</code> string Sim Codigo de barras. Caso n\u00e3o tenha vencimento, busque dentro do PDF."},{"location":"municipal/","title":"\ud83d\udce6 Padr\u00e3o de Payload \u2013 API Municipais","text":"<p>Esta documenta\u00e7\u00e3o define o formato padr\u00e3o esperado para o payload de comunica\u00e7\u00e3o \u00e0 API Municipais.</p>"},{"location":"municipal/#rotas-disponiveis","title":"\ud83d\udd01 Rotas Dispon\u00edveis","text":"<p>Todas as rotas utilizam o m\u00e9todo HTTP <code>POST</code>.</p> Rota Descri\u00e7\u00e3o <code>/consultar</code> Consulta as notas j\u00e1 escrituradas ou status. <code>/escriturar</code> Realiza a escritura\u00e7\u00e3o das notas. <code>/guia</code> Gera a guia de recolhimento (ISS ou similar). <code>/excluir</code> Exclui uma nota."},{"location":"municipal/#consultar","title":"\ud83d\udd0d Consultar","text":"<p>A opera\u00e7\u00e3o de consulta permite recuperar informa\u00e7\u00f5es sobre notas fiscais previamente escrituradas em determinado per\u00edodo, bem como verificar a integridade e o status das notas processadas via integra\u00e7\u00e3o.</p>"},{"location":"municipal/#requisicao","title":"\ud83d\udd3c Requisi\u00e7\u00e3o","text":"<p>Requisi\u00e7\u00e3o para a rota <code>/consultar</code></p> <p>Metodo: <code>POST</code></p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo dados_acesso.</p>"},{"location":"municipal/#dados_acesso-objeto","title":"\ud83d\udd10 <code>dados_acesso</code> (objeto)","text":"<p>Objeto que cont\u00e9m as credenciais de autentica\u00e7\u00e3o e os par\u00e2metros de filtragem por compet\u00eancia, utilizados para estabelecer a sess\u00e3o de comunica\u00e7\u00e3o com o sistema municipal e delimitar o escopo da consulta.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>municipio</code> string Sim Nome do municipio. <code>inscricao</code> string Sim CNPJ/CPF/Inscricao estadual/inscricao municipal da empresa (somente n\u00fameros). <code>extra</code> string N\u00e3o Informa\u00e7\u00f5es extras. Para caso a prefeitura precise de mais informa\u00e7\u00f5es. <code>login_password</code> string Sim Senha de login. <code>mes</code> integer Sim M\u00eas de compet\u00eancia (1 a 12). <code>ano</code> integer Sim Ano de compet\u00eancia (ex: <code>2025</code>). <code>identificador</code> string N\u00e3o Identificador da prefeitura. Algumas prefeituras precisam do numero identificador para fazer login. <code>nome_filial</code> string N\u00e3o Nome da filial. Algumas prefeituras precisam para identificar a filial. <code>certificado_b64</code> string N\u00e3o Certificado digital em base64 no formato <code>.pfx</code>. <code>certificado_password</code> string N\u00e3o Senha do certificado digital."},{"location":"municipal/#exemplo-de-payload","title":"\ud83d\udcd1 Exemplo de Payload","text":"<pre><code>{\n  \"dados_acesso\": {\n    \"municipio\": \"prata\",\n    \"inscricao\": \"27473570\",\n    \"extra\": \"extra\",\n    \"login_password\": \"123456\",\n    \"mes\": 5,\n    \"ano\": 2025,\n    \"identificador\": \"123456\",\n    \"nome_filial\": \"Filial 1\",\n    \"certificado_b64\": \"-----BEGIN CERTIFICATE-----\\n-----END CERTIFICATE-----\",\n    \"certificado_password\": \"123456\"\n\n  }\n}\n</code></pre> <p>Obs: N\u00e3o precisamos enviar na consulta as <code>notas</code> pois ser\u00e3o descartadas. Assim conseguimos montar payloads mas f\u00e1cil de ler. </p>"},{"location":"municipal/#resposta","title":"\ud83d\udd3d  Resposta","text":"<p>Formato: <code>json</code></p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>cnpj_filial</code> string Sim CNPJ do emitente da nota (somente n\u00fameros). <code>nome_municipio</code> string N\u00e3o Nome do municipio. <code>cnpj_prestador</code> string Sim CNPJ do prestador. Alguns municipios n\u00e3o tem o CNPJ do prestador, para esses casos precisa ver com o cliente <code>numero_nota</code> integer Sim N\u00famero da nota fiscal. Sempre que possivel envie como inteiro. Se tiver 0 \u00e0 esquerda ou for muito longo envie como string. <code>data_emissao</code> string Sim Data de emiss\u00e3o no formato <code>DD/MM/AAAA</code>. <code>situacao</code> boolean Sim Indica se houve reten\u00e7\u00e3o de ISS (<code>true</code> ou <code>false</code>). <code>total</code> float Sim Valor total da nota incluidos os ISS. <code>valor_principal</code> float Sim Valor somente do ISS. <code>chave</code> string Sim Chave montada juntando <code>cnpj_filial</code> + <code>cnpj_prestador</code> + <code>numero_nota</code> + <code>data_emissao</code> Pode manter o \"/\" da data de emiss\u00e3o."},{"location":"municipal/#escriturar","title":"\ud83d\udcdd Escriturar","text":"<p>A opera\u00e7\u00e3o de escritura\u00e7\u00e3o permite a inclus\u00e3o de notas fiscais no sistema municipal.</p>"},{"location":"municipal/#requisicao_1","title":"\ud83d\udd3c Requisi\u00e7\u00e3o","text":"<p>Requisi\u00e7\u00e3o para a rota <code>/escriturar</code></p> <p>Metodo: <code>POST</code></p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo dados_acesso e notas.</p>"},{"location":"municipal/#dados_acesso-objeto_1","title":"\ud83d\udd10 <code>dados_acesso</code> (objeto)","text":"<p>Objeto que cont\u00e9m as credenciais de autentica\u00e7\u00e3o e os par\u00e2metros de filtragem por compet\u00eancia, utilizados para estabelecer a sess\u00e3o de comunica\u00e7\u00e3o com o sistema municipal e delimitar o escopo da consulta.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>municipio</code> string Sim Nome do municipio. <code>inscricao</code> string Sim CNPJ/CPF/Inscricao estadual/inscricao municipal da empresa (somente n\u00fameros). <code>extra</code> string N\u00e3o Informa\u00e7\u00f5es extras. Para caso a prefeitura precise de mais informa\u00e7\u00f5es. <code>login_password</code> string Sim Senha de login. <code>mes</code> integer Sim M\u00eas de compet\u00eancia (1 a 12). <code>ano</code> integer Sim Ano de compet\u00eancia (ex: <code>2025</code>). <code>identificador</code> string N\u00e3o Identificador da prefeitura. Algumas prefeituras precisam do numero identificador para fazer login. <code>nome_filial</code> string N\u00e3o Nome da filial. Algumas prefeituras precisam para identificar a filial. <code>certificado_b64</code> string N\u00e3o Certificado digital em base64 no formato <code>.pfx</code>. <code>certificado_password</code> string N\u00e3o Senha do certificado digital."},{"location":"municipal/#notas-array-de-objetos","title":"\ud83d\udcc4 <code>notas</code> (array de objetos)","text":"<p>Lista de notas fiscais a serem escrituradas.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o Exemplo <code>id</code> integer Sim Identificador interno da nota. ID da nota no DB 1 <code>cnpj_prestador</code> string Sim CNPJ do prestador da nota (somente n\u00fameros). \"12345678901234\" <code>nome_municipio</code> string Sim Nome do municipio. \"prata\" <code>numero_nota</code> string Sim N\u00famero da nota fiscal. \"123456789\" <code>serie</code> string N\u00e3o S\u00e9rie da nota fiscal. \"A\" <code>data_emissao</code> string Sim Data de emiss\u00e3o no formato <code>DD/MM/AAAA</code>. \"01/01/2025\" <code>retido</code> boolean Sim Indica se houve reten\u00e7\u00e3o de ISS (<code>true</code> ou <code>false</code>). false <code>valor_nota</code> string Sim Valor da nota fiscal. Separado por \".\" (ponto) \"100.00\" <code>aliquota</code> string Sim Valor da al\u00edquota da nota fiscal. Separado por \".\" (ponto) \"2.00\" <code>cod_servico</code> string Sim C\u00f3digo do servi\u00e7o. \"07.01\" <code>valor_iss</code> string Sim Valor do ISS. Separado por \".\" (ponto) \"10.00\" <code>simples</code> boolean Sim Indica se o prestador possui simples nacional (<code>true</code> ou <code>false</code>). true <code>cod_ibge</code> string Sim C\u00f3digo do IBGE do municipio do prestador. \"123456\""},{"location":"municipal/#exemplo-de-payload_1","title":"\ud83d\udcd1 Exemplo de Payload","text":"<pre><code>{\n  \"dados_acesso\": {\n    \"municipio\": \"prata\",\n    \"inscricao\": \"27473570\",\n    \"extra\": \"extra\",\n    \"login_password\": \"123456\",\n    \"mes\": 5,\n    \"ano\": 2025,\n    \"identificador\": \"123456\",\n    \"nome_filial\": \"Filial 1\",\n    \"certificado_b64\": \"-----BEGIN CERTIFICATE-----\\n-----END CERTIFICATE-----\",\n    \"certificado_password\": \"123456\"\n\n  },\n  \"notas\": [\n    {\n      \"id\": 1,\n      \"cnpj_prestador\": \"27473570\",\n      \"nome_municipio\": \"S\u00e3o Paulo\",\n      \"numero_nota\": \"123456789\",\n      \"serie\": \"A\",\n      \"data_emissao\": \"01/01/2025\",\n      \"retido\": false,\n      \"valor_nota\": \"100.00\",\n      \"aliquota\": \"2.00\",\n      \"cod_servico\": \"1234\",\n      \"valor_iss\": \"10.00\",\n      \"simples\": false\n    }\n  ]\n}\n</code></pre>"},{"location":"municipal/#resposta_1","title":"\ud83d\udd3d Resposta","text":"<p>A maioria das API's rodam dentro de workers(processos ass\u00edncronos) utilizando rq, portanto, a resposta n\u00e3o \u00e9 retornada diretamente ao cliente.</p> <p>Como \u00e9 um processo ass\u00edncrono, precisamos retornar um <code>id</code> que representa o status da escritura\u00e7\u00e3o.</p> <p>Algumas notas ser\u00e3o escrituradas em batchs, por isso, o <code>id</code> retornado n\u00e3o representa uma unica nota, mas sim um batch de notas.</p> <p>Exemplo: S\u00e3o Enviados 50 notas, mas s\u00e3o criados batches de 10 notas, por isso, o <code>id</code> retornado representa o status de 5 batches.</p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo <code>id</code> gerada automaticamente pelo worker.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o <code>id</code> integer Sim ID do status da escritura\u00e7\u00e3o. <code>status</code> string Sim Status da escritura\u00e7\u00e3o."},{"location":"municipal/#resposta-de-escriturar-no-worker","title":"\ud83d\udd28 Resposta de escriturar no worker","text":"<p>Mesmo as notas escrituradas dentro do worker precisam retornar algo para a gente saber se foram escrituradas ou n\u00e3o.</p> <p>Atualmente salvamos o status da escritura\u00e7\u00e3o no DB, mas isso pode mudar.</p> <p>Retorne <code>true</code> no <code>sucesso</code> se foi escriturada, <code>false</code> se n\u00e3o foi escriturada.</p> <p>Formato: <code>json</code> | <code>dict</code></p> <p>Body: Array de Objeto JSON.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o <code>id</code> integer Sim ID do status da escritura\u00e7\u00e3o. <code>sucesso</code> boolean Sim Status da escritura\u00e7\u00e3o <code>true</code> ou <code>false</code>. <code>numero_nota</code> string Sim N\u00famero da nota escriturada. <code>cnpj_prestador</code> string Sim CNPJ do prestador. <code>mensagem</code> string Sim Mensagem com o motivo do erro. <p>Obs: Deve retornar isso para cada nota escriturada. Independente se voc\u00ea j\u00e1 salvou no DB ou n\u00e3o, pois precisamos dessa informa\u00e7\u00e3o para criar o log.</p>"},{"location":"municipal/#gerar","title":"\ud83d\udcdd Gerar","text":"<p>A Opera\u00e7\u00e3o para gera\u00e7\u00e3o de guias de recolhimento para pagamento de ISS.</p>"},{"location":"municipal/#requisicao_2","title":"\ud83d\udd3c Requisi\u00e7\u00e3o","text":"<p>Requisi\u00e7\u00e3o para a rota <code>/gerar</code></p> <p>Metodo: <code>POST</code></p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo dados_acesso e notas.</p>"},{"location":"municipal/#dados_acesso-objeto_2","title":"\ud83d\udd10 <code>dados_acesso</code> (objeto)","text":"<p>Objeto que cont\u00e9m as credenciais de autentica\u00e7\u00e3o e os par\u00e2metros de filtragem por compet\u00eancia, utilizados para estabelecer a sess\u00e3o de comunica\u00e7\u00e3o com o sistema municipal e delimitar o escopo da consulta.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>municipio</code> string Sim Nome do municipio. <code>inscricao</code> string Sim CNPJ/CPF/Inscricao estadual/inscricao municipal da empresa (somente n\u00fameros). <code>extra</code> string N\u00e3o Informa\u00e7\u00f5es extras. Para caso a prefeitura precise de mais informa\u00e7\u00f5es. <code>login_password</code> string Sim Senha de login. <code>mes</code> integer Sim M\u00eas de compet\u00eancia (1 a 12). <code>ano</code> integer Sim Ano de compet\u00eancia (ex: <code>2025</code>). <code>identificador</code> string N\u00e3o Identificador da prefeitura. Algumas prefeituras precisam do numero identificador para fazer login. <code>nome_filial</code> string N\u00e3o Nome da filial. Algumas prefeituras precisam para identificar a filial. <code>certificado_b64</code> string N\u00e3o Certificado digital em base64 no formato <code>.pfx</code>. <code>certificado_password</code> string N\u00e3o Senha do certificado digital. <p>Deixar isso para conversar depois com o pessoal por causa dos municipios que n\u00e3o precisam escriturar, s\u00f3 escolhem a nota para gerar a guia</p>"},{"location":"municipal/#resposta_2","title":"\ud83d\udd3d Resposta","text":"<p>Resposta da rota <code>/gerar</code></p> <p>Formato: <code>json</code></p> <p>Body: Objeto JSON contendo o campo guias.</p>"},{"location":"municipal/#guia-objeto","title":"\ud83d\udcc4 guia (Objeto)","text":"<p>Objeto contendo as informa\u00e7\u00f5es da guia de recolhimento. O PDF precisa ser convertido para base64.</p> Campo Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o Observa\u00e7\u00e3o <code>pdf</code> string Sim PDF da guia de recolhimento. O PDF precisa ser convertido para base64. <code>vencimento</code> string Sim Data de vencimento da guia de recolhimento(DD/MM/AAAA). Caso n\u00e3o tenha vencimento, busque dentro do PDF. <code>valor_principal</code> float Sim Valor somente do ISS. Caso n\u00e3o tenha vencimento, busque dentro do PDF. <code>valor_base</code> float Sim Valor total da nota incluidos os ISS. Caso n\u00e3o tenha vencimento, busque dentro do PDF. <code>codigo_barra</code> string Sim Codigo de barras. Caso n\u00e3o tenha vencimento, busque dentro do PDF."}]}